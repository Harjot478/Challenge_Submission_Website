<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Challenge Submission</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <header>
      <nav class="main-nav" role="navigation" aria-label="Main navigation">
        <a class="nav-button" href="#home">Home</a>
        <a class="nav-button" href="#post-challenge">Post a Challenge (Company)</a>
        <a class="nav-button" href="#view-challenges">View Challenges (Students)</a>
        <a class="nav-button" href="#submit-work">Submit Work</a>
        <a class="nav-button" href="#past-winners">Past Winners</a>
      </nav>
    </header>

    <nav>
      <a href="index.html">Home</a>
      <a href="post.html">Post a Challenge</a>
      <a href="challenges.html">View Challenges</a>
      <a href="submit.html">Submit Work</a>
      <a href="winners.html">Past Winners</a>
    </nav>

    <main id="home" class="section">
      <h1>Home</h1>
      <p>Use the navigation above to explore the site.</p>
    </main>

    <section id="post-challenge" class="section">
      <h1>Post a Challenge (Company)</h1>
      <p>Companies can add a new challenge here. (Placeholder content.)</p>
      <div class="iframe-wrap" data-src="https://docs.google.com/forms/d/e/1FAIpQLSe-n_SjKz1GNjZTgG69zMcdIUNbDcvJOmAcNaXVi9Ei6SuOYQ/viewform?embedded=true"></div>
    </section>

    <section id="view-challenges" class="section">
      <h1>View Challenges (Students)</h1>
      <p>Students can browse current challenges. (Placeholder content.)</p>
    </section>

    <section id="submit-work" class="section submit-section">
      <h1>Submit Your Work</h1>
      <p>Please complete the form below to enter a challenge.</p>
      <div class="iframe-wrap" data-src="https://docs.google.com/forms/d/e/1FAIpQLScHolwY_JJs9W6CjaF-xNmH-4g-SQQiduZ3P5aL7M4uxV8VkA/viewform?embedded=true"></div>
    </section>

    <section id="past-winners" class="section">
      <h1>Past Winners</h1>
      <p>See previous winners and their submissions. (Placeholder content.)</p>
    </section>

    <script>
      document.addEventListener('DOMContentLoaded', function(){
        const navButtons = document.querySelectorAll('.main-nav .nav-button');
        const sections = document.querySelectorAll('.section');

        function removeAllIframes() {
          document.querySelectorAll('.iframe-wrap').forEach(w => {
            const ex = w.querySelector('iframe');
            if (ex) ex.remove();
          });
        }

        function loadIframeForSection(sec) {
          const wrap = sec.querySelector('.iframe-wrap');
          if (wrap && wrap.dataset.src && !wrap.querySelector('iframe')) {
            const ifr = document.createElement('iframe');
            ifr.src = wrap.dataset.src;
            ifr.width = '700';
            ifr.height = '520';
            ifr.style.width = '700px';
            ifr.style.height = '520px';
            ifr.setAttribute('frameborder', '0');
            ifr.setAttribute('marginheight', '0');
            ifr.setAttribute('marginwidth', '0');
            ifr.textContent = 'Loading…';
            ifr.loading = 'lazy';
            ifr.title = sec.id + ' form';
            wrap.appendChild(ifr);

            // Attempt same-origin redirect detection (may be blocked for cross-origin)
            ifr.addEventListener('load', () => {
              try {
                const href = ifr.contentWindow.location.href || '';
                if (href.includes('formResponse') || href.includes('formResponse?') || href.includes('formResponse/')) {
                  window.location.href = 'thankyou.html';
                }
              } catch (err) {
                // Cross-origin iframe — cannot access location; no-op
              }
            });
          }
        }

        function showSection(id) {
          sections.forEach(s => s.classList.toggle('active', s.id === id));
          navButtons.forEach(b => b.classList.toggle('active', b.getAttribute('href') === '#' + id));
          removeAllIframes();
          const active = document.getElementById(id);
          if (active) loadIframeForSection(active);
        }

        navButtons.forEach(btn => {
          btn.addEventListener('click', function(e){
            e.preventDefault();
            const target = this.getAttribute('href').replace('#','');
            showSection(target);
            history.replaceState(null, '', '#' + target);
          });
        });

        // Initial state: show based on hash or default to home
        const initial = location.hash ? location.hash.replace('#','') : 'home';
        showSection(initial);
      });
    </script>
  </body>
</html>
